---
title: "dash-test"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE, dev="CairoPNG"}
knitr::opts_chunk$set(dev="CairoPNG")
library(tidyverse)
library(flexdashboard)
library(zoo)
source("FUNCTIONS.R")
```

```{r read_data}
state_cleaned <- readRDS("data/state_raw.rds")%>%
  select(date=1,posTest=2, negTest=5,tests=7,cases=9,admissions=15,discharges=17,currentHosp=21,ICU=23,vent=24,dailyDeaths=25,
         totalDosesPriorDay=29, totalDose1=32, totalDose2=34)%>%
  filter(row_number() >= 11)%>%
  mutate(percentPos = round((cases/tests * 100),1),
         Avg7Day_Cases = movingAvg(cases),
         percentChange_cases = pctChange(Avg7Day_Cases),
         Last7Days_100k = round((rollsumr(cases, 7, fill=NA,align='right')) * (100000/1059361),0),
         percentChange_100k = pctChange(Last7Days_100k),
         Avg7Day_Tests = movingAvg(tests),
         Avg7Day_Pos = movingAvg(percentPos, 1),
         Avg7Day_Adm = movingAvg(admissions),
         Avg7Day_Hosp = movingAvg(currentHosp),
         Avg7Day_ICU = movingAvg(ICU),
         Avg7Day_Vent = movingAvg(vent),
         Avg7Day_Deaths = movingAvg(dailyDeaths),
         totalDosesPriorDay=na_if(totalDosesPriorDay, "--")%>%as.numeric,
         Avg7Day_totalDosesPriorDay=movingAvg(totalDosesPriorDay),
         percentChange_totalDoses = pctChange(Avg7Day_totalDosesPriorDay))
```


Column {}
---

### Daily Cases (7-Day Average)

```{r}
vb_dec(state_cleaned$Avg7Day_Cases, state_cleaned$percentChange_cases)
```

### Cases per 100,000 (7-Day Sum)

```{r}
vb_dec(state_cleaned$Last7Days_100k, state_cleaned$percentChange_100k)
```

Column {}
---

### Hospitalizations/Deaths

```{r}

```


### Vaccines (7-Day Average, Doses Administered)

```{r}
vb_inc(state_cleaned$Avg7Day_totalDosesPriorDay, state_cleaned$percentChange_totalDoses)
```

